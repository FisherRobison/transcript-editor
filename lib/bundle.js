!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("draft-js"),require("immutable"),require("react"),require("transcript-model"),require("lodash.debounce"),require("uuid/v4")):"function"==typeof define&&define.amd?define(["draft-js","immutable","react","transcript-model","lodash.debounce","uuid/v4"],e):"object"==typeof exports?exports["transcript-editor"]=e(require("draft-js"),require("immutable"),require("react"),require("transcript-model"),require("lodash.debounce"),require("uuid/v4")):t["transcript-editor"]=e(t["draft-js"],t.immutable,t.react,t["transcript-model"],t["lodash.debounce"],t["uuid/v4"])}(this,function(t,e,r,n,a,i){return function(t){function e(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.convertToTranscript=e.convertFromTranscript=e.TranscriptEntities=e.TranscriptEditorSpace=e.TranscriptEditorWord=e.TranscriptEditorBlock=void 0;var a=r(11),i=n(a),o=r(5),s=n(o),u=r(7),c=n(u),d=r(6),l=n(d),f=r(4),p=n(f),y=r(8),h=n(y),g=r(9),T=n(g);e.default=i.default,e.TranscriptEditorBlock=s.default,e.TranscriptEditorWord=c.default,e.TranscriptEditorSpace=l.default,e.TranscriptEntities=p.default,e.convertFromTranscript=h.default,e.convertToTranscript=T.default},function(e,r){e.exports=t},function(t,r){t.exports=e},function(t,e){t.exports=r},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.TRANSCRIPT_SPACE="TRANSCRIPT_SPACE",e.TRANSCRIPT_WORD="TRANSCRIPT_WORD",e.TRANSCRIPT_PLACEHOLDER="TRANSCRIPT_PLACEHOLDER"},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(3),i=n(a),o=r(1),s=function(t){return i.default.createElement("div",{className:"transcript-editor-block"},i.default.createElement("div",{className:"transcript-editor-block__speaker",contentEditable:!1,style:{MozUserSelect:"none",WebkitUserSelect:"none",msUserSelect:"none"}},"Speaker ",t.block.data.get("speaker")),i.default.createElement("div",{className:"transcript-editor-block__text"},i.default.createElement(o.EditorBlock,t)))};s.propTypes={block:i.default.PropTypes.object},e.default=s,t.exports=e.default},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(3),i=n(a),o=function(t){var e=t.offsetKey,r=t.children;return i.default.createElement("span",{id:"space-"+e,className:"transcript-editor-block__space"},r)};o.propTypes={offsetKey:i.default.PropTypes.string,children:i.default.PropTypes.array},e.default=o,t.exports=e.default},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(3),i=n(a),o=r(1),s=function(t){var e=t.entityKey,r=t.children,n=o.Entity.get(e),a=""+n.data.start.toFixed(2)+(" - "+n.data.end.toFixed(2));return i.default.createElement("span",{title:a,id:"word-"+n.data.id,"data-start":n.data.start,"data-end":n.data.end,className:"transcript-editor-block__word"},r)};s.propTypes={entityKey:i.default.PropTypes.string,children:i.default.PropTypes.array},e.default=s,t.exports=e.default},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(1),i=r(2),o=n(i),s=r(15),u=n(s),c=function(t){var e=t.get("segments").map(function(t,e){return new a.ContentBlock({key:e.toString(),characterList:t.get("words").map(function(t){var e=a.Entity.create("TRANSCRIPT_WORD","MUTABLE",{start:t.get("start"),end:t.get("end"),id:t.get("id")||(0,u.default)()});return new o.default.List(t.get("text").split("").map(function(){return a.CharacterMetadata.applyEntity(a.CharacterMetadata.create(),e)}))}).interpose(new o.default.List([a.CharacterMetadata.applyEntity(a.CharacterMetadata.create(),a.Entity.create("TRANSCRIPT_SPACE","IMMUTABLE",null))])).flatten(1),text:t.get("words").map(function(t){return t.get("text")}).join(" "),data:new o.default.Map({speaker:t.get("speaker")})})}),r=a.ContentState.createFromBlockArray(e),n=t.get("speakers");return{contentState:r,speakers:n}};e.default=c,t.exports=e.default},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(1),i=r(2),o=n(i),s=r(10),u=function(t,e){var r=t.getBlockMap().toArray().map(function(t){var e=[];return t.findEntityRanges(function(t){var e=t.getEntity();return null!==e&&"TRANSCRIPT_WORD"===a.Entity.get(e).getType()},function(r,n){var i=a.Entity.get(t.getEntityAt(r)),o=t.getText().substring(r,n);e.push(new s.TranscriptWord({start:i.data.start,end:i.data.end,id:i.data.id,text:o}))}),new s.TranscriptSegment({words:new o.default.List(e),speaker:t.data.get("speaker")})});return new s.Transcript({segments:new o.default.List(r),speakers:e})};e.default=u,t.exports=e.default},function(t,e){t.exports=n},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),c=r(3),d=n(c),l=r(1),f=r(2),p=n(f),y=r(14),h=n(y),g=r(10),T=r(8),E=n(T),v=r(9),b=n(v),S=r(12),C=n(S),_=r(5),m=n(_),R=r(7),k=n(R),P=r(6),x=n(P),A=r(4);r(13);var M=function(t){function e(t){a(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.state={editorState:l.EditorState.createEmpty(),speakers:[],disabled:t.disabled||!1},r.onChange=r.onChange.bind(r),r.handleBeforeInput=r.handleBeforeInput.bind(r),r.handleReturn=r.handleReturn.bind(r),r.blockRenderer=r.blockRenderer.bind(r),r.handleKeyboardEvent=r.handleKeyboardEvent.bind(r),r.debouncedSendTranscriptUpdate=(0,h.default)(r.sendTranscriptUpdate,500),r.decorator=new l.CompositeDecorator([{strategy:function(t,e){t.findEntityRanges(function(t){var e=t.getEntity();if(null===e)return!1;var r=l.Entity.get(e).getType();return r===A.TRANSCRIPT_WORD},e)},component:k.default},{strategy:function(t,e){t.findEntityRanges(function(t){var e=t.getEntity();if(null===e)return!1;var r=l.Entity.get(e).getType();return r===A.TRANSCRIPT_SPACE},e)},component:x.default}]),r}return o(e,t),u(e,[{key:"componentWillMount",value:function(){this.props.transcript&&this.instantiateEditor(this.props.transcript)}},{key:"componentWillReceiveProps",value:function(t){this.setState({disabled:t.disabled||!1});var e=t.transcript;e&&this.state.transcript!==e&&this.instantiateEditor(e)}},{key:"onChange",value:function(t){var e=this;if(!this.state.disabled){var r=t.getCurrentContent(),n=this.state.editorState,a=t.getLastChangeType(),i=t.getSelection(),o=n.getSelection();if(this.props.onSelectionChange&&i!==o&&this.sendSelectionChange(r,i),"undo"!==a&&r!==n.getCurrentContent()){var u=function(){e.debouncedSendTranscriptUpdate(r,e.state.speakers);var t=i.getStartKey(),s=o.getStartKey(),u=r.getBlockMap(),c=u.reduce(function(e,r,a){var o=r;if(a===t){if(o.characterList.isEmpty())return e;var c=i.getStartOffset();u.size<n.getCurrentContent().getBlockMap().size&&l.Entity.get(o.characterList.get(c).entity).type===A.TRANSCRIPT_WORD&&l.Entity.get(o.characterList.get(c-1).entity).type===A.TRANSCRIPT_WORD&&(o=o.set("characterList",o.characterList.insert(c,l.CharacterMetadata.applyEntity(l.CharacterMetadata.create(),l.Entity.create(A.TRANSCRIPT_SPACE,"IMMUTABLE",null)))).set("text",""+o.text.slice(0,c)+(" "+o.text.slice(c)))),o=o.merge((0,C.default)(o,n.getCurrentContent().getBlockForKey(a))),l.Entity.get(o.characterList.first().entity).type===A.TRANSCRIPT_SPACE&&(o=o.set("characterList",o.characterList.shift()).set("text",o.text.substring(1))),o.data.isEmpty()&&(o=o.set("data",e.last().data))}else a===s&&l.Entity.get(o.characterList.last().entity).type===A.TRANSCRIPT_SPACE&&(o=o.set("characterList",o.characterList.pop()).set("text",o.text.substring(0,o.text.length-1)));return e.set(a,o)},new p.default.OrderedMap),d=r.set("blockMap",c);return e.setState({editorState:l.EditorState.push(n,d,a)}),{v:void 0}}();if("object"===("undefined"==typeof u?"undefined":s(u)))return u.v}this.setState({editorState:t})}}},{key:"instantiateEditor",value:function(t){var e=(0,E.default)(t),r=e.contentState,n=e.speakers;this.setState({editorState:l.EditorState.createWithContent(r,this.decorator),speakers:n,transcript:t}),this.sendTranscriptUpdate(r,n)}},{key:"handleBeforeInput",value:function(t){if(" "===t){var e=this.state.editorState,r=e.getSelection(),n=r.getStartKey(),a=r.getStartOffset(),i=e.getCurrentContent().getBlockForKey(n),o=i.getEntityAt(a-1);if(o&&l.Entity.get(o).type===A.TRANSCRIPT_SPACE)return!0}return!1}},{key:"handleKeyboardEvent",value:function(t){return(0,l.getDefaultKeyBinding)(t)?(0,l.getDefaultKeyBinding)(t):(this.props.onKeyboardEvent&&this.props.onKeyboardEvent(t),null)}},{key:"blockRenderer",value:function(){return{component:m.default,props:{speakers:this.state.speakers}}}},{key:"focus",value:function(){this.editor.focus()}},{key:"sendTranscriptUpdate",value:function(t,e){this.props.onTranscriptUpdate((0,b.default)(t,e))}},{key:"sendSelectionChange",value:function(t,e){var r=e.isBackward?e.focusKey:e.anchorKey,n=e.isBackward?e.focusOffset:e.anchorOffset,a=e.isBackward?e.anchorKey:e.focusKey,i=e.isBackward?e.anchorOffset:e.focusOffset,o=t.getBlockForKey(r).getEntityAt(n),s=t.getBlockForKey(a).getEntityAt(i),u=o&&l.Entity.get(o),c=s&&l.Entity.get(s);this.props.onSelectionChange({startTime:u&&u.data.start,startWordID:u&&u.data.id,startBlockKey:r,startCharacterOffset:n,endTime:c&&c.data.end,endID:c&&c.data.id,endBlockKey:a,endCharacterOffset:i})}},{key:"handleReturn",value:function(){var t=this.state.editorState,e=t.getSelection(),r=e.getStartKey(),n=e.getStartOffset(),a=t.getCurrentContent().getBlockForKey(r),i=a.getEntityAt(n-1),o=a.getEntityAt(n);return!(i&&l.Entity.get(i).type===A.TRANSCRIPT_SPACE||o&&l.Entity.get(o).type===A.TRANSCRIPT_SPACE)}},{key:"handlePastedText",value:function(){return!0}},{key:"render",value:function(){var t=this,e=this.state.editorState;return d.default.createElement("div",{className:"transcript-editor"},d.default.createElement(l.Editor,{ref:function(e){t.editor=e},editorState:e,onChange:this.onChange,handleReturn:this.handleReturn,handleBeforeInput:this.handleBeforeInput,keyBindingFn:this.handleKeyboardEvent,handlePastedText:this.handlePastedText,blockRendererFn:this.blockRenderer}))}}]),e}(c.Component);M.propTypes={transcript:d.default.PropTypes.instanceOf(g.Transcript),onTranscriptUpdate:d.default.PropTypes.func,onSelectionChange:d.default.PropTypes.func,disabled:d.default.PropTypes.bool,onKeyboardEvent:d.default.PropTypes.func},e.default=M,t.exports=e.default},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(2),i=n(a),o=r(1),s=r(4),u=function(t){return t.characterList.reduce(function(e,r,n){var a=e.characterList,i=e.text;if(!a.isEmpty()){var u=a.last();if(!u.entity)return{characterList:a.set(-1,o.CharacterMetadata.applyEntity(u,r.entity)).push(r),text:i+t.text[n]};if(r.entity){var c=o.Entity.get(r.entity),d=o.Entity.get(u.entity);if(c.type===d.type&&c!==d)return o.Entity.mergeData(u.entity,{end:c.data.end}),{characterList:a.push(o.CharacterMetadata.applyEntity(r,u.entity)),text:i+t.text[n]};if(c.type===s.TRANSCRIPT_SPACE&&d.type===s.TRANSCRIPT_SPACE)return{characterList:a,text:i}}}return{characterList:a.push(r),text:i+t.text[n]}},{characterList:new i.default.List,text:""})};e.default=u,t.exports=e.default},function(t,e){},function(t,e){t.exports=a},function(t,e){t.exports=i}])});
//# sourceMappingURL=bundle.js.map